<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Data Tracker</title>
    
    <!-- ফন্ট এবং আইকন -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #00f260;
            --secondary: #0575e6;
            --bg-color: #0f0c29;
            --card-bg: #1a1a2e;
            --text-color: #ffffff;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: var(--text-color);
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0f0c29; z-index: 1000;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 20px; box-sizing: border-box;
            transition: transform 0.4s ease;
        }
        .login-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px; border-radius: 20px;
            width: 100%; max-width: 350px;
            text-align: center; border: 1px solid rgba(255,255,255,0.1);
        }
        input {
            width: 100%; padding: 15px; margin: 15px 0;
            background: rgba(0,0,0,0.3); border: 1px solid #444;
            border-radius: 10px; color: white; font-size: 16px;
            box-sizing: border-box; outline: none;
        }
        .btn-grad {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border: none; padding: 15px; width: 100%;
            border-radius: 10px; color: white; font-weight: bold;
            font-size: 16px; cursor: pointer;
        }

        /* --- DASHBOARD --- */
        #dashboard { display: none; padding: 20px; padding-bottom: 100px; max-width: 500px; margin: 0 auto; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .user-badge { background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; font-size: 12px; }

        .main-card {
            background: rgba(255,255,255,0.05);
            border-radius: 24px; padding: 30px 20px;
            text-align: center; border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .main-val { font-size: 42px; font-weight: 700; color: var(--primary); }
        .label { font-size: 14px; color: #aaa; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 15px; text-align: center; }
        .stat-num { font-size: 20px; font-weight: 600; color: var(--secondary); margin-top: 5px; }

        /* LIST */
        .history-title { font-size: 14px; margin-bottom: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .log-item {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.05); padding: 12px 15px;
            border-radius: 12px; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .log-date { font-size: 10px; color: #888; display: block; }
        .trash-icon { color: #ff4b4b; cursor: pointer; padding: 5px; }

        /* FAB Button */
        .fab {
            position: fixed; bottom: 30px; right: 30px;
            width: 60px; height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: white; cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            z-index: 100;
        }

        /* Modal */
        .modal {
            display: none; position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8); z-index: 200;
            justify-content: center; align-items: center;
        }
        .modal-content { background: #1f1b36; padding: 25px; border-radius: 20px; width: 80%; max-width: 320px; }
    </style>
</head>
<body>

    <!-- 1. Login Screen -->
    <div id="login-screen">
        <div class="login-card">
            <i class="fas fa-sim-card" style="font-size: 40px; color: #00f260; margin-bottom: 20px;"></i>
            <h2 style="margin: 0;">Data Tracker</h2>
            <p style="color: #aaa; font-size: 12px; margin-bottom: 20px;">আপনার মোবাইল নম্বর দিয়ে লগইন করুন</p>
            <input type="number" id="phoneInput" placeholder="Ex: 01712345678">
            <button class="btn-grad" id="loginBtn">ENTER DASHBOARD</button>
        </div>
    </div>

    <!-- 2. Dashboard -->
    <div id="dashboard">
        <div class="header">
            <div>
                <div style="font-size: 10px; color: #888;">WELCOME</div>
                <div id="displayPhone" style="font-weight: 600;">...</div>
            </div>
            <div class="user-badge" onclick="logout()" style="cursor: pointer; border: 1px solid #ff4b4b; color: #ff4b4b;">LOGOUT</div>
        </div>

        <div class="main-card">
            <div class="label">THIS MONTH (30 DAYS)</div>
            <div class="main-val"><span id="monthlyVal">0.00</span> <span style="font-size: 18px;">GB</span></div>
            <div style="height: 6px; background: #333; border-radius: 10px; margin-top: 15px; overflow: hidden;">
                <div id="progressBar" style="height: 100%; background: #00f260; width: 0%;"></div>
            </div>
        </div>

        <div class="grid">
            <div class="stat-box">
                <i class="fas fa-clock" style="color: #aaa;"></i>
                <div class="stat-num" id="dailyVal">0</div>
                <div style="font-size: 10px; color: #888;">Today (MB)</div>
            </div>
            <div class="stat-box">
                <i class="fas fa-calendar-week" style="color: #aaa;"></i>
                <div class="stat-num" id="weeklyVal">0</div>
                <div style="font-size: 10px; color: #888;">7 Days (GB)</div>
            </div>
        </div>

        <div class="history-title">Recent Logs</div>
        <div id="logList">
            <!-- Data will load here -->
            <p style="text-align: center; color: #444; font-size: 12px;">No data added yet.</p>
        </div>
    </div>

    <!-- 3. Add Button -->
    <div class="fab" onclick="openModal()"><i class="fas fa-plus"></i></div>

    <!-- 4. Input Popup -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <h3 style="margin-top:0; color:white;">Add Usage</h3>
            <input type="number" id="mbInput" placeholder="Amount in MB (e.g. 120)">
            <button class="btn-grad" id="saveBtn">SAVE DATA</button>
            <button onclick="closeModal()" style="background:none; border:none; color:#888; width:100%; margin-top:15px; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <!-- Firebase Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // আপনার কনফিগারেশন
        const firebaseConfig = {
            apiKey: "AIzaSyBR68TeYik1NhVyIIjSyxWlFkHj3aGrUBw",
            authDomain: "total-data-3992a.firebaseapp.com",
            databaseURL: "https://total-data-3992a-default-rtdb.firebaseio.com",
            projectId: "total-data-3992a",
            storageBucket: "total-data-3992a.firebasestorage.app",
            messagingSenderId: "344531256358",
            appId: "1:344531256358:web:03bf1e0a9928724fa7d2e7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let userPhone = localStorage.getItem('my_tracker_user');

        // --- Auth Check ---
        function checkAuth() {
            if(userPhone) {
                document.getElementById('login-screen').style.transform = 'translateY(-100%)';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('displayPhone').innerText = userPhone;
                loadData();
            } else {
                document.getElementById('login-screen').style.transform = 'translateY(0)';
                document.getElementById('dashboard').style.display = 'none';
            }
        }

        document.getElementById('loginBtn').addEventListener('click', () => {
            const input = document.getElementById('phoneInput').value;
            if(input.length > 5) {
                userPhone = input;
                localStorage.setItem('my_tracker_user', input);
                checkAuth();
            } else {
                alert("Please enter a valid number");
            }
        });

        window.logout = function() {
            localStorage.removeItem('my_tracker_user');
            location.reload();
        }

        // --- Database Logic ---
        function loadData() {
            const logsRef = ref(db, 'users/' + userPhone + '/logs');
            onValue(logsRef, (snapshot) => {
                const data = snapshot.val();
                processData(data);
            });
        }

        function processData(data) {
            const list = document.getElementById('logList');
            list.innerHTML = "";
            
            if(!data) {
                document.getElementById('dailyVal').innerText = "0";
                document.getElementById('weeklyVal').innerText = "0.00";
                document.getElementById('monthlyVal').innerText = "0.00";
                document.getElementById('progressBar').style.width = "0%";
                list.innerHTML = '<p style="text-align: center; color: #444; font-size: 12px;">Start adding data using the + button.</p>';
                return;
            }

            let daily = 0, weekly = 0, monthly = 0;
            const now = new Date();
            const entries = Object.entries(data).reverse(); // Show new ones first

            entries.forEach(([key, val]) => {
                const logTime = new Date(val.timestamp);
                const diffTime = now - logTime;
                const diffDays = diffTime / (1000 * 60 * 60 * 24);

                // Calculation
                if(logTime.toDateString() === now.toDateString()) daily += val.mb;
                if(diffDays <= 7) weekly += val.mb;
                if(diffDays <= 30) monthly += val.mb;

                // Create List Item
                const div = document.createElement('div');
                div.className = 'log-item';
                div.innerHTML = `
                    <div>
                        <span style="color:white; font-weight:600;">${val.mb} MB</span>
                        <span class="log-date">${logTime.toLocaleString()}</span>
                    </div>
                    <i class="fas fa-trash trash-icon" onclick="deleteEntry('${key}')"></i>
                `;
                list.appendChild(div);
            });

            // Update UI
            document.getElementById('dailyVal').innerText = daily.toFixed(0);
            document.getElementById('weeklyVal').innerText = (weekly / 1024).toFixed(2);
            document.getElementById('monthlyVal').innerText = (monthly / 1024).toFixed(2);

            // Progress (Example Target 30GB)
            const pct = (monthly / 30720) * 100;
            document.getElementById('progressBar').style.width = Math.min(pct, 100) + "%";
        }

        // --- Actions ---
        document.getElementById('saveBtn').addEventListener('click', () => {
            const mb = parseFloat(document.getElementById('mbInput').value);
            if(mb > 0) {
                const logsRef = ref(db, 'users/' + userPhone + '/logs');
                push(logsRef, {
                    mb: mb,
                    timestamp: Date.now()
                });
                closeModal();
                document.getElementById('mbInput').value = "";
            }
        });

        window.deleteEntry = function(key) {
            if(confirm("Delete this?")) {
                const itemRef = ref(db, 'users/' + userPhone + '/logs/' + key);
                remove(itemRef);
            }
        }

        // Modal Controls
        window.openModal = () => document.getElementById('addModal').style.display = 'flex';
        window.closeModal = () => document.getElementById('addModal').style.display = 'none';

        // Init
        checkAuth();

    </script>
</body>
</html>